{% extends "base.html" %}
{% load static %}

{% block title %}Projects{% endblock %}

{% block content %}
<div class="container">
  <h2 class="section-title">All Projects <i class="uil uil-rocket"></i></h2>

  <!-- ðŸ” Search + Filter -->
  <form method="GET" action="{% url 'projects' %}" class="search-filters">
    <input type="text" 
          name="q" 
          placeholder="ðŸ” Search projects..."
          value="{{ query }}">

    <select name="category" onchange="this.form.submit()">
      <option value="all">All Categories</option>
      {% for cat in categories %}
        <option value="{{ cat.slug }}"
                {% if selected_category == cat.slug %}selected{% endif %}>
          {{ cat.name }}
        </option>
      {% endfor %}
    </select>

    <button type="submit">Search</button>
  </form>

  <!-- ðŸ“‚ Projects -->
  <div class="project-grid">
    {% for project in projects %}
      <div class="project-card">
        {% if project.image %}
          <img src="{{ project.image.url }}" alt="{{ project.title }}" class="project-image" />
        {% endif %}
        <h3>
          <a href="{% url 'project_details' project.slug %}" style="text-decoration: none;">
            {{ project.title }}
          </a>
        </h3>
        <p>{{ project.description|truncatewords:25|safe }}</p>
        <div class="project-meta">
      <span><i class="uil uil-calendar-alt"></i> {{ project.created_at }}</span>
      <span><i class="uil uil-eye"></i> {{ project.views }} views</span>
      <span>
        <form method="POST" style="display:inline;">
          {% csrf_token %}
          <button type="submit" name="like" style="all:unset; cursor:pointer;">
            <i class="uil uil-heart"></i>
          </button>
          {{ project.likes }} likes
        </form>
      </span>
      <span><i class="uil uil-comment-alt-lines"></i> {{ comments.count }} comments</span>
    </div>
        <div class="project-links">
          {% if project.live_url %}
            <a href="{{ project.live_url }}" target="_blank">View Project</a>
          {% endif %}
          <a href="{% url 'project_details' slug=project.slug %}" class="more-info">More Info</a>
        </div>
      </div>
    {% empty %}
      <p>No projects found.</p>
    {% endfor %}
  </div>
</div>

<!-- ðŸ”¢ Pagination -->
<div class="pagination">
  {% if projects.has_previous %}
    <a href="?page=1{% if selected_category and selected_category != 'all' %}&category={{ selected_category }}{% endif %}{% if query %}&q={{ query }}{% endif %}" class="button button--outline">&laquo; First</a>
    <a href="?page={{ projects.previous_page_number }}{% if selected_category and selected_category != 'all' %}&category={{ selected_category }}{% endif %}{% if query %}&q={{ query }}{% endif %}" class="button button--outline">Previous</a>
  {% endif %}

  <span class="button disabled">
    Page {{ projects.number }} of {{ projects.paginator.num_pages }}
  </span>

  {% if projects.has_next %}
    <a href="?page={{ projects.next_page_number }}{% if selected_category and selected_category != 'all' %}&category={{ selected_category }}{% endif %}{% if query %}&q={{ query }}{% endif %}" class="button button--outline">Next</a>
    <a href="?page={{ projects.paginator.num_pages }}{% if selected_category and selected_category != 'all' %}&category={{ selected_category }}{% endif %}{% if query %}&q={{ query }}{% endif %}" class="button button--outline">Last &raquo;</a>
  {% endif %}
</div>
{% endblock %}
